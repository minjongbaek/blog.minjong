---
import Layout from "@/layouts/Layout.astro";
import TagItem from "@/components/TagItem";
import { getCollection } from "astro:content";

const tagCount: { [key: string]: number } = {};

const tags = [
  ...new Set(
    (await getCollection("post")).flatMap((post) => {
      post.data.tags.forEach((tag) => {
        if (Object.hasOwn(tagCount, tag)) {
          tagCount[tag] += 1;
        } else {
          tagCount[tag] = 1;
        }
      });
      return post.data.tags;
    })
  ),
];
---

<Layout>
  <div>
    <div class="my-4 flex gap-2 text-2xl flex-wrap">
      {tags.map((tag) => <TagItem tag={tag} count={tagCount[tag]} />)}
    </div>
  </div>
</Layout>
